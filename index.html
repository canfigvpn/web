<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CanfigVpn</title>
<style>
:root { --primary-color:#ff6600; --card-radius:10px; }
body { font-family:sans-serif; margin:0; padding:0; background:#f5f5f5; }
header{background:var(--primary-color); color:#fff; padding:1rem; text-align:center;}
.tabs{display:flex; justify-content:center; margin:1rem 0;}
.tab{padding:0.5rem 1rem; cursor:pointer; border-radius:5px; margin:0 0.5rem; background:#ddd;}
.tab.active{background:var(--primary-color); color:#fff;}
.content{max-width:1000px; margin:0 auto;}
.card{background:#fff; padding:1rem; margin:1rem 0; border-radius:var(--card-radius); box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.card h3{margin:0 0 0.5rem 0;}
.slider{position:relative; overflow:hidden; border-radius:var(--card-radius);}
.slider img{width:100%; display:none;}
.slider img.active{display:block;}
button{padding:0.5rem 1rem; margin-top:0.5rem; cursor:pointer; border:none; background:var(--primary-color); color:#fff; border-radius:5px;}
.price-container{display:flex; flex-wrap:wrap; justify-content:center;}
.price-card{background:#fff; padding:1rem; margin:0.5rem; border-radius:var(--card-radius); width:200px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.price-card.guarantee{border:2px solid green;}
.price-card.no-guarantee{border:2px solid red;}
</style>
</head>
<body>
<header><h1>CanfigVpn</h1></header>
<div class="tabs" id="tabs"></div>
<div class="content" id="content"></div>

<script>
let siteData;
async function fetchData(){
  const res = await fetch("/api/data")
  siteData = await res.json()
  renderTabs()
  renderContent(siteData.tabs[0])
  renderPrices()
}

function renderTabs(){
  const tabsEl = document.getElementById("tabs")
  tabsEl.innerHTML = ""
  siteData.tabs.forEach(tab=>{
    const el = document.createElement("div")
    el.className="tab"
    el.innerText=tab
    el.onclick=()=>{document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active")); el.classList.add("active"); renderContent(tab)}
    tabsEl.appendChild(el)
  })
  document.querySelectorAll(".tab")[0].classList.add("active")
}

function renderContent(tab){
  const contentEl = document.getElementById("content")
  contentEl.innerHTML=""
  const apps = siteData.apps[tab]
  
  apps.downloads.forEach(app=>{
    const card = document.createElement("div"); card.className="card"
    card.innerHTML=`<h3>${app.name}</h3><a href="${app.link}" target="_blank"><button>دانلود</button></a>`
    contentEl.appendChild(card)
  })

  if(apps.images.length>0){
    const sliderCard = document.createElement("div"); sliderCard.className="card slider"
    apps.images.forEach((img,i)=>{
      const imgEl = document.createElement("img")
      imgEl.src=img
      if(i===0) imgEl.classList.add("active")
      sliderCard.appendChild(imgEl)
    })
    contentEl.appendChild(sliderCard)
    startSlider(sliderCard)
  }
}

function startSlider(slider){
  let idx=0
  const images = slider.querySelectorAll("img")
  setInterval(()=>{
    images[idx].classList.remove("active")
    idx=(idx+1)%images.length
    images[idx].classList.add("active")
  },3000)
}

function renderPrices(){
  const contentEl = document.getElementById("content")
  const container = document.createElement("div"); container.className="price-container"
  siteData.prices.forEach(p=>{
    const card = document.createElement("div"); 
    card.className="price-card "+(p.guarantee?"guarantee":"no-guarantee")
    card.innerHTML=`<h4>${p.name}</h4><p>${p.time} | ${p.volume}</p><p>${p.price}</p>`
    container.appendChild(card)
  })
  contentEl.appendChild(container)
}

fetchData()
</script>
</body>
</html>